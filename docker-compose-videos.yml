version: "2"

services:
  nginx-videos:
    image: nginx:1.25-alpine
    container_name: nginx-videos
    volumes:
      - ./videos-nginx-conf-default.conf:/etc/nginx/conf.d/default.conf:ro
      - ./videos-nginx.htpasswd:/etc/nginx/recordings.htpasswd:ro
      - videos:/opt/videos:ro
    restart: unless-stopped
    environment:
      VIRTUAL_HOST: "videos.bojidar-bg.dev"
      LETSENCRYPT_HOST: "videos.bojidar-bg.dev"

volumes:
  videos:
    driver: rclone # mkdir /var/lib/docker-plugins/rclone/{config,cache} && cp /root/.config/rclone/rclone.conf /var/lib/docker-plugins/rclone/config && docker plugin install rclone/docker-volume-rclone:arm64 args="-v" --alias rclone --grant-all-permissions
    driver_opts:
      remote: 'storagebox:videos'
      gid: 101
      uid: 101
      allow_other: 'true'
      # vfs_cache_mode: full
      # poll_interval: 0
